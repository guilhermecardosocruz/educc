import withPWA from "next-pwa";

const isProd = process.env.NODE_ENV === "production";

const runtimeCaching = [
  { urlPattern: ({ request }) => request.mode === "navigate",
    handler: "NetworkFirst",
    options: { cacheName: "pages", expiration: { maxEntries: 50, maxAgeSeconds: 7*24*3600 } } },
  { urlPattern: /_next\/static\/.*/i, handler: "StaleWhileRevalidate",
    options: { cacheName: "next-static" } },
  { urlPattern: /\/icons\/.*\.png$/i, handler: "CacheFirst",
    options: { cacheName: "icons", expiration: { maxEntries: 16 } } },
  { urlPattern: /\.(?:png|jpg|jpeg|svg|gif|webp|avif)$/i, handler: "StaleWhileRevalidate",
    options: { cacheName: "images" } },
  { urlPattern: /\/api\/.*/i, handler: "NetworkFirst",
    options: { cacheName: "api", networkTimeoutSeconds: 3 } }
];

const baseConfig = { reactStrictMode: true };

export default withPWA({
  eslint: { ignoreDuringBuilds: true },
  dest: "public",
  disable: !isProd,   // n√£o afeta o dev
  register: true,
  skipWaiting: true,
  runtimeCaching,
  fallbacks: { document: "/offline.html" }
})(baseConfig);
